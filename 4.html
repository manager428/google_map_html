<html>
    <head>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
        <link
            rel="stylesheet"
            href="https://use.fontawesome.com/releases/v5.13.0/css/all.css"
            integrity="sha384-Bfad6CLCknfcloXFOyFnlgtENryhrpZCe29RTifKEixXQZ38WheV+i/6YWSzkz3V"
            crossorigin="anonymous"
            />
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
            <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
            <script src="https://unpkg.com/@google/markerclustererplus@4.0.1/dist/markerclustererplus.min.js"></script>
            <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCPWW4q6F5GW49NYrYQqdvnnoNEy-U_YKU&callback=initMap&libraries=&v=weekly" async defer></script>

            <style> 
                .gm-style .gm-style-iw-c{
                    max-height: 600px!important;
                  
                }
                .gm-style-iw-d{
                    max-height: 600px!important;
                }
               
                #product_image{
                    width: 400px;
                    margin-top: 20px;
                }
                .item-img-width{
                    border-left: solid 2px #212121;
                    border-right: solid 2px #212121;
                }
                .product_image_title{
                    background-color: #212121;
                    height: 25px;
                    width: 384px;
                    color: #b0b0b0;
                }
                .product_desc{
                    line-height: 24px;
                    font-size: 16px;
                }
                .map_desc{
                    font-weight: 600;
                    color: #b0b0b0;
                }
                .map_icons{
                    font-size: 18px;
                    font-weight: 600;
                    color: #b0b0b0;
                }
            </style>

            <script>
                let map;

                function initMap() {
                    map = new google.maps.Map(document.getElementById("map"), {
                        center: new google.maps.LatLng(44.4946348, 11.3397436),
                        zoom: 16,
                        options: {
                            gestureHandling: 'greedy'
                        }
                    });
                    const iconBase =
                    "https://res.cloudinary.com/senior/image/upload/v1635503945/";
                    const icons = {
                        map_one: {
                            icon: {
                                url: iconBase + "map_1_fathex.png", // image is 512 x 512
                                scaledSize : new google.maps.Size(56, 56),
                            },
                        }
                    
                    };
                    const features = [
                        {
                            position: new google.maps.LatLng(44.4946348, 11.3397436),
                            type: "map_one",
                        }
                    ];

                    // Create markers.

                    const markers = features.map((feature, i) => {
                        return new google.maps.Marker({
                            position: feature.position,
                            icon: icons[feature.type].icon,
                            map: map,
                        });
                    });
                    const infowindow = new google.maps.InfoWindow();
                   
                    var carousel4 = '<div class="row slider-item-max-width mx-1 mb-1">';
                            carousel4 += '<div class="col-lg-3 col-md-3 col-sm-12">';
                                carousel4 += '<h6 class="">Bologna</h6>';
                            carousel4 += '</div>';
                        carousel4 += '</div>';

                        carousel4 += '<div id="product_image" class="carousel4 slide" data-ride="carousel4" data-interval="90000"><div class="carousel4-inner item-margin slider-width" role="listbox"><div class="carousel4-item col-12 px-2 active"><img class="item-img-width w-100" src="https://www.wolocity.com/public/componenti/1243/f1/9.webp" alt="slide 1"></div></div>'
                        carousel4 += '<div class="row slider-item-max-width mx-1 mb-1">';
                            carousel4 += '<div class="col-12 px-1">';
                                carousel4 += '<div class="product_image_title justify-content-center align-items-center d-flex">2 di 2</div>';
                                carousel4 += '<p class="mt-3 mb-0 product_desc"><u>Bologna - Piazza del Nettuno</u>: Posizionamento n. 2 <b>Urban Station</b> equipaggiate in totale da 10 monopattini elettrici a marchio <b>WoloCity</b>. Prezzo per singola stazione comprensiva di 5 monopattini: <b>14.900â‚¬</b></p>';
                            carousel4 += '</div>';
                            carousel4 += '<div class="col-6 px-0 mt-5">';
                                carousel4 += '<span class="mb-0 pl-2 map_desc">2/3</span>';
                            carousel4 += '</div>';
                        carousel4 += '</div>';
                    
                        var testing = [carousel4]
                    for(var i = 0; i < markers.length; i++){
                        var marker = markers[i];
                        var text = testing[i];
                        attachInstructionText(
                            infowindow,
                            marker,
                            text,
                            map
                        );
                    }
                
                    new MarkerClusterer(map, markers, {
                        imagePath:
                        "https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m",
                    });
                
                }
                function attachInstructionText(stepDisplay, marker, text, map) {
                    google.maps.event.addListener(marker, "click", () => {
                        // Open an info window when the marker is clicked on, containing the text
                        // of the step.
                        stepDisplay.setContent(text);
                        stepDisplay.open(map, marker);
                    });
                }

            </script>
    </head>



<body>
    <div class="preloader">
        <svg class="circular" viewBox="25 25 50 50">
            <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10" />
        </svg>
    </div>

    <div class="page-wrapper">
        <div class="container-fluid">
            
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body">
                            <div id="map" style="height: 90vh;width: 100%;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function(){
            $(".preloader").fadeOut();
        });
        $('#carouselSearch').on('slide.bs.carousel', function (e) {
    
            var $e = $(e.relatedTarget);
            var idx = $e.index();
            var itemsPerSlide = 3;
            var totalItems = $('.carousel-item').length;
            console.log(idx);
            console.log(itemsPerSlide);
            console.log(totalItems);
            if (idx >= totalItems-(itemsPerSlide-1)) {
                var it = itemsPerSlide - (totalItems - idx);
                for (var i=0; i<it; i++) {
                    // append slides to end
                    if (e.direction=="left") {
                        $('.carousel-item').eq(i).appendTo('.carousel-inner');
                    }
                    else {
                        $('.carousel-item').eq(0).appendTo('.carousel-inner');
                    }
                }
            }
        });
        $('#searchBar').on('slide.bs.carousel', function (e) {
    
            var $e = $(e.relatedTarget);
            var idx = $e.index();
            var itemsPerSlide = 8;
            var totalItems = $('.carousel-item').length;
            console.log(idx);
            console.log(itemsPerSlide);
            console.log(totalItems);
            if (idx >= totalItems-(itemsPerSlide-1)) {
                var it = itemsPerSlide - (totalItems - idx);
                for (var i=0; i<it; i++) {
                    // append slides to end
                    if (e.direction=="left") {
                        $('.carousel-item').eq(i).appendTo('.carousel-inner');
                    }
                    else {
                        $('.carousel-item').eq(0).appendTo('.carousel-inner');
                    }
                }
            }
        });
    </script>
</body>


</html>